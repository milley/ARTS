# 为什么面向对象编程很糟糕

[Why OO Sucks by Joe Armstrong](http://harmful.cat-v.org/software/OO_programming/why_oo_sucks)

当我第一次听说OOP的理论时不知道为什么我持怀疑态度-只是感觉是错的。在后来OOP被大力推广后，批评OOP就像是在教堂游泳。OO的思想变成了每个编程语言需要拥有的特性。

随着Erlang的流行我一直被问到Erlang是否支持OO-当然正确答案是“不，当然不支持”-但是我不能大声的说出这些-所以我们发明了严肃而又巧妙的方法回答，设计给人的印象Erlang是OO（某种程度上）（如果您挥舞了很多次手），但不是真的（如果您听了我真正在说什么，并仔细阅读小字）。

在这一点上我想起了当时IBM的法国老板在巴黎举行的第七届IEEE Logic编程会议上致辞的主题演讲。当被问及为什么IBM prolog增加了很多OO扩展时，他是这样回答的：

“因为我们的客户需要有OO的prolog因此我们提供了OO”

我记得当时这样的回答多么简单，没有良心不安，没有灵魂提问，没有问到”这是最好的...“

## 为什么OO很糟糕

我对OOP的主要反对意见可以追溯到所涉及的基本思想。我将概述其中的一些想法和反对意见。

### 意见1 - 数据结果和功能不能绑定在一起

对象已不可分割的单位将功能和数据结构绑定在一起。我认为这是一个基本错误，因为数据结构和功能完全属于不同的世界。为什么这样说？

函数做事情，它们有输入和输出。输入和输出是数据结构，它们可以通过函数修改。在大多数语言中，函数是根据命令序列构建的：”做这些然后做那些...“要了解函数你必须了解函数的执行顺序（在懒惰的FPL和逻辑语言中，这个限制已经放松）。

- 数据结构仅仅是，他们不做任何事，它们本质上是声明式的。了解数据结构比了解函数容易的多。

函数可以理解成将输入转换成输出的黑盒子。如果我能理解输入输出那么我就能理解函数。这并不意味着我就能写这样的函数。

函数经常被理解成通过观察计算系统中的事务，其工作是将类型为T1的数据结构转换为类型T2的数据结构。

由于函数和数据结构是两种完全不同类型的东西，因此将它们锁到一个笼子中是不对的。

### 意见2 - 任何事务都是对象

考虑下时间。在面向对象中time是被作为一个对象。但是在非面向对象语言中time就是一种数据类型的实例。例如，在Erlang中有很多不同类型的时间，它们使用类型声明可以清楚明确的指定，下面这样：

```Erlang
-deftype day() = 1..31.
-deftype month() = 1..12.
-deftype year() = int().
-deftype hour() = 1..24.
-deftype minute() = 1..60.
-deftype second() = 1..60.
-deftype abstime() = {abstime, year(), month(), day(), hour(), min(), sec()}.
-deftype hms() = {hms, hour(), min(), sec()}.
```

注意这些不属于任何特定对象。它们无处不在，并且表示时间的数据结构可以由系统中的任何函数来操作。没有相关的方法。

### 意见3 - 在OOPL中数据类型定义遍布各处

在OOP语言中数据类型定义属于对象。所以我们无法在一处找到所有的定义。在Erlang或者C我可以在一个单独头文件或者数据字典中定义所有的数据类型。在OOP语言中无法完成-数据类型定义遍布各处。

让我给你一个例子。假设我想定义一个无处不在的数据结构，无处不在的数据类型是在系统各处发生的数据类型。正如Lisp程序员早就知道的那样，最好有少量无处不在的数据类型和大量可以用它们的小型函数，而不是拥有大量的数据类型和少量的函数。

无处不在的数据类型是诸如链表，数组或哈希表或更高级的对象（如时间或日期或文件名）之类的东西。

### 意见4 - 对象有私有的状态

状态是万恶之源。特别应避免有副作用的函数。

尽管编程语言中的状态是不可取的，但在现实世界中状态比比皆是。我对银行账户的状态非常感兴趣，当我从银行存款或取款时，我希望银行的状态能够正确更新。

考虑到现实中存在状态，编程语言应该提供哪些设施来处理状态？

- OOP语言表示“为程序员隐藏状态”。状态只能通过函数隐藏或看到
- 常规编程语言(C,Pascal)表示状态变量的可见性由语言的作用域规则控制
- 纯函数语言没有状态

系统的全局状态包含在所有函数中，并且来自于所有函数。诸如monad(FPL)和DCG之类的机制用于向程序员隐藏状态，以便他们可以就像状态无关进行编程，但是在必要是可以完全访问系统状态。

OOP语言中为程序员隐藏状态是最糟糕的选择。他们没有揭露状态并试图找到最小化状态的方法，而是将其隐藏了起来。

## 为什么OO这么受欢迎

- 原因1 - 被认为很容易的学习
- 原因2 - 被认为重用代码很容易
- 原因3 - 被大肆宣传
- 原因4 - 它创造了一个新的软件行业

我无法赞同1和2。原因3和4似乎是背后的推动力。如果一种语言技术非常糟糕，以至于创造了一个新的行业来解决自己的生产问题，那么对于要赚钱的家伙来说，这一定是一门好的生意。

这就是OOP背后真正的推动力。
